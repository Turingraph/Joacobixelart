import { t_canvas, t_canvas_grid, valid_height } from "./utils"

export function paint_1_grid_default(
	arr:t_canvas,
	grid:number,
	input:undefined|string|boolean
){
	if (typeof input === "boolean")
	{
		arr.arr[grid].select = input
		return arr
	}
	arr.arr[grid].rgb = input
	return arr
}

export function paint_1_grid<
	k extends keyof t_canvas_grid, 
	e extends t_canvas_grid[k]>(
	arr:t_canvas,
	grid:number,
	input:e,
	key:k|undefined = undefined
){
	if (key !== undefined)
	{
		arr.arr[grid][key] = input
		return arr
	}
	if (["boolean", undefined, "string"].includes(typeof input))
		return paint_1_grid_default(arr, grid, input)
	return arr
}

export function paint_brush(
	arr:t_canvas,
	rgb:undefined|string|boolean,
	grid:number,
	size:number,
	mode:"UP"|"DOWN"|"LEFT"|"RIGHT"|"MIDDLE_X"|"MIDDLE_Y"
){
	const width = arr.width
	const height= Math.floor(arr.arr.length/width)
	let update_arr = {
	arr:[...arr.arr],
	width:arr.width
	} as t_canvas
	if (size < 1)
		return update_arr
	update_arr = paint_1_grid(update_arr, grid, rgb)
	if (["MIDDLE_X", "MIDDLE_Y"].includes(mode))
	{
		const right=Math.floor((size+1)/2)
		const left = size % 2 === 0 ? right + 1 : right
		update_arr = paint_brush(
			update_arr,
			rgb,
			grid,
			left,
			"MIDDLE_X" === mode ? "LEFT" : "UP"
		)
		update_arr = paint_brush(
			update_arr,
			rgb,
			grid,
			right,
			"MIDDLE_X" === mode ? "RIGHT" : "DOWN"
		)
		return update_arr
	}
	const dir = ["UP", "LEFT"].includes(mode) ? -1 : 1
	let i = 1
	while (i < size)
	{
		if (["LEFT", "RIGHT"].includes(mode) && i < width)
			update_arr = paint_1_grid(
				update_arr, 
				grid + i * dir, 
				rgb)
		else if (["LEFT", "RIGHT"].includes(mode) && i >= width)
			i = size
		if (["UP", "DOWN"].includes(mode) 
			&& valid_height(grid + i * width * dir, height, width))
			update_arr = paint_1_grid(
				update_arr, 
				grid + i * width * dir,
				rgb)
		else if (["UP", "DOWN"].includes(mode) && i >= height)
			i = size
		i += 1
	}
	return update_arr
}

export function paint_point(
	arr:t_canvas,
	rgb:undefined|string|boolean,
	grid:number,
	size:number,
){
	const width = arr.width
	let update_arr = {
	arr:[...arr.arr],
	width:width
	} as t_canvas
	update_arr = paint_brush(update_arr, rgb, grid, size, "MIDDLE_Y")
	let i = 1
	while (i < (size)/2 && i < width)
	{
		update_arr = paint_brush(update_arr, rgb, grid+i, size, "MIDDLE_Y")
		update_arr = paint_brush(update_arr, rgb, grid-i, size, "MIDDLE_Y")
		i += 1
	}
	if ((size)%2 === 0)
		update_arr = paint_brush(update_arr, rgb, grid-i, size, "MIDDLE_Y")
	return update_arr
}

/*
export function paint_brush(
	arr:t_canvas,
	rgb:undefined|string|boolean,
	grid:number,
	size:number,
	mode:"UP"|"DOWN"|"LEFT"|"RIGHT"|"MIDDLE_X"|"MIDDLE_Y"
){
	console.log("Nujabes")
	const width = arr.width
	let update_arr = {
	arr:[...arr.arr],
	width:width
	} as t_canvas
	if (size < 1)
		return update_arr
	if (["MIDDLE_X", "MIDDLE_Y"].includes(mode))
	{
		update_arr = paint_brush(
			update_arr,
			rgb,
			grid,
			size % 2 === 0 ? Math.floor(size/2) + 1 : Math.floor(size/2),
			"MIDDLE_X" === mode ? "LEFT" : "UP"
		)
		update_arr = paint_brush(
			update_arr,
			rgb,
			grid,
			Math.floor(size/2),
			"MIDDLE_X" === mode ? "RIGHT" : "DOWN"
		)
		return update_arr
	}
	update_arr = paint_1_grid(update_arr, grid, rgb)
	const height = Math.floor(update_arr.arr.length/width)
	const [y, x] = get_yx(grid, width)
	let i = 1 * (mode === "UP" ? -1 : 1)
	let j = 1 * (mode === "LEFT" ? -1 : 1)
	if (["UP", "DOWN"].includes(mode))
		j = 0
	else
		i = 0
	while (Math.abs(i) < size && Math.abs(j) < size && valid_2d(
		height,
		y + i,
		width,
		x + j
	))
	{
		update_arr = paint_1_grid(update_arr, access_yx([y + i, x + j], width), rgb)
		if (i > 0)
			i += 1 * (mode === "UP" ? -1 : 1)
		if (j > 0)
			j += 1 * (mode === "LEFT" ? -1 : 1)
	}
	return update_arr
}

export function paint_point(
	arr:t_canvas,
	rgb:undefined|string|boolean,
	grid:number,
	size:number,
){
	const height = Math.floor(arr.arr.length/arr.width)
	const [y, x] = get_yx(grid, arr.width)
	let i = 0
	while (i < Math.floor(size/2) && valid_2d(
		height,
		y + i,
		arr.width,
		x
	))
	{
		arr = paint_brush(
			arr,
			rgb,
			access_yx([y + i, x], arr.width),
			size,
			"MIDDLE_X"
		)
		arr = paint_brush(
			arr,
			rgb,
			access_yx([y - i, x], arr.width),
			size,
			"MIDDLE_X"
		)
	}
	if (size % 2 === 0)
	{
		arr = paint_brush(
			arr,
			rgb,
			access_yx([y - i, x], arr.width),
			size,
			"MIDDLE_X"
		)
	}
	return arr
}

export function paint_rectangle_donut(
	arr:t_canvas,
	rgb:undefined|string|boolean,
	size:number,
	rectangle:[number,number]
){
	let [up, left] = get_yx(rectangle[0], arr.width)
	let [down, right] = get_yx(rectangle[1], arr.width)
	left = swap_less_than(left, right)[0]
	right = swap_less_than(left, right)[1]
	up = swap_less_than(up, down)[0]
	down = swap_less_than(up, down)[1]
	let i = up
	while (i <= down)
	{
		let j = left
		if (i < up + size || i > down - size)
		{
			while (j <= right)
			{
				arr = paint_brush(
					arr, rgb, 
					access_yx([i, j], arr.width), 1, "UP")
				j += 1
			}
		}
		else
		{
			arr = paint_brush(arr, rgb, access_yx([i, j], arr.width), size, "RIGHT")
			arr = paint_brush(arr, rgb, access_yx([i, right - j], arr.width), size, "LEFT")
		}
		i += 1
	}
}

export function paint_rectangle(
	arr:t_canvas,
	rgb:undefined|boolean|string,
	rectangle:[number,number]
){
	let [up, left] = get_yx(rectangle[0], arr.width)
	let [down, right] = get_yx(rectangle[1], arr.width)
	left = swap_less_than(left, right)[0]
	right = swap_less_than(left, right)[1]
	up = swap_less_than(up, down)[0]
	down = swap_less_than(up, down)[1]
	let i = up
	while (i <= down)
	{
		let j = left
		while (j <= right)
		{
			arr = paint_1_grid(arr, access_yx([i, j], arr.width), rgb)
			j += 1
		}
		i += 1
	}
	return arr
}

export function paint_outside_rectangle(
	arr:t_canvas,
	rgb:undefined|boolean|string,
	rectangle:[number,number]
){
	let [up, left] = get_yx(rectangle[0], arr.width)
	let [down, right] = get_yx(rectangle[1], arr.width)
	left = swap_less_than(left, right)[0]
	right = swap_less_than(left, right)[1]
	up = swap_less_than(up, down)[0]
	down = swap_less_than(up, down)[1]
	const height = Math.floor(arr.arr.length/arr.width)
	let i = 0
	while (i < height)
	{
		let j = 0
		while (j < arr.width)
		{
			if ((i < up || i > down || j < left || j > right) 
				&& valid_2d(height, i, arr.width, j))
				arr = paint_1_grid(arr, access_yx([i, j], arr.width), rgb)
			j += 1
		}
		i += 1
	}
	return arr
}

export function paint_scale(
	arr:t_canvas,
	rgb:undefined|boolean|string,
	grid:number,
	width:number,
	height:number
){
	const [y,x] = get_yx(grid, arr.width)
	let i = 0
	while (i < height)
	{
		arr = paint_brush(arr, rgb, access_yx([y + i, x], arr.width), width, "RIGHT")
		i += 1
	}
	return arr
}
*/

